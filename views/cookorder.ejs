<% layout("/layouts/biolerplatecook") %>
<body>
    <div class="container mt-5">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h2 class="mb-0">Booking Data</h2>
                <!-- Search Form -->
                <input class="form-control w-25" id="searchInput" type="text" placeholder="Search">
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="thead-dark">
                            <tr>
                                <th>User</th>
                                <th>Title</th>
                                <th>Address</th>
                                <th>Date</th>
                                <th>Time Slot</th>
                                <th>Status</th>
                                <th>Created At</th>
                            </tr>
                        </thead>
                        <tbody id="bookingTable">
                            <% bookings.forEach(booking => { %>
                            <tr class="
                                align-middle
                                <%= booking.status === 'pending' ? 'table-warning' : '' %>
                                <%= booking.status === 'confirmed' ? 'table-success' : '' %>
                                <%= booking.status === 'completed' ? 'table-primary' : '' %>
                                <%= booking.status === 'cancelled' ? 'table-danger' : '' %>
                            ">
                                <td><%= booking.user.name %></td>
                                <td><%= booking.title %></td>
                                <td><%= booking.address %></td>
                                <td><%= new Date(booking.date).toLocaleDateString() %></td>
                                <td><%= booking.timeSlot %></td>
                                <td>
                                    <form method="POST" action="/cook/bookings/<%= booking._id %>?_method=PUT">
                                        <div class="form-group">
                                            <select name="status" id="status" class="form-control">
                                                <option value="pending" <%= booking.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                                <option value="confirmed" <%= booking.status === 'confirmed' ? 'selected' : '' %>>Confirmed</option>
                                                <option value="completed" <%= booking.status === 'completed' ? 'selected' : '' %>>Completed</option>
                                                <option value="cancelled" <%= booking.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                                            </select>
                                            <button type="submit" class="btn btn-sm btn-primary mt-2">Update</button>
                                        </div>
                                    </form>
                                </td>
                                <td><%= new Date(booking.createdAt).toLocaleString() %></td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script>
        // JavaScript to filter table rows
        document.getElementById('searchInput').addEventListener('keyup', function() {
            var input = this.value.toLowerCase();
            var rows = document.querySelectorAll('#bookingTable tr');

            rows.forEach(function(row) {
                var cells = row.querySelectorAll('td');
                var match = false;

                cells.forEach(function(cell) {
                    if (cell.textContent.toLowerCase().indexOf(input) > -1) {
                        match = true;
                    }
                });

                if (match) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
